# GLLSS - Global Loot League Staff Scheduler

GLLSS is a web application created to make the life of GLL Staff easier.
It includes many features which are supposed to make spreadsheet usage no longer necessary, automate some processes and open new possibilities.
The list of features can be found [here](#features).

## Backstory
Once I joined GLL team my dear friend Michelle (host lead for GLL) told me about the web app idea which was suggested by one of the employees. She wanted to make it on her own but since she was lacking time and skills needed I offered my help to take over the development. I started right away (5th of March 2020) and after 1.5 month the primary version was ready.

## Features

## Tech
- ### Backend
  - Node.js
  - MongoDB
  - bcrypt
  - Nodemailer
  - Joi
  - Winston, morgan
  - JSONWebToken
- ### Frontend
  - Vue.js with Vuex/Vue Router
  - Vuetify
  - Babel
  - Webpack
  - Axios
  - moment

### Installation

GLLSS requires [Node.js](https://nodejs.org/) v8.\* to run.

Install the dependencies and devDependencies and start the server.

```sh
$ cd gllss
$ npm install
$ node index
```
## Introduction
Purpose of the site is to help staff, especially hosts and teamleaders of GLL to make schedule for them when to work as the main aspect. They can put their availability for certain tournaments and then being scheduled. Site offers as well more functionalities to ease the work. There are several roles to divide people based on their position. We will look into each role and describe the site, functionalities and possibilities within each role.

## Roles
Site does work on roles principle. There are several roles where next role has something more to access and inherit all the rights from previous role: Right now there are these roles:
- Uncomfirmed User
- Guest
- Host
- TeamLeader
- Admin
- MasterAdmin

### Unconfirmed User
First thing first, to access the site a person has to register. On the image shown, it can be seen how the login page looks like.

![Login Page](https://i.imgur.com/avUSHKr.png)

Clicking on **Register now**, you will be able to create an account where you need to select:
* Nickname - which is at least 2 characters long, has to be unique
* Email address - your email address, has to be unique
* Password - Has to consist of at least one number, one capital letter and has to be at least 5 characters long

Once you do fill all the information and you wil ltry to log in, you will see the site will not allow it and will throw an error.

![Verification error](https://i.imgur.com/dqh0bfO.png)

To step up from this, you have to go to your email address and check the email, so you can confirm your account. If you cannot see any email, try to look into trashbin. If you still cannot find it, then you can click on **Need Verification Email?** Email should like like picture below and you can either click on button or link.

![Verification error](https://i.imgur.com/EKkQPSE.png).

Once you click on the Button, you will become Guest and will be able to log in.

### Guest
As a guest you will be able to log in to the side and see the message, that before you can continue you have to be confirmed as shown on the picture. 

![Guest Menu](https://i.imgur.com/845Gfd6.png)

List of current admins is generated by database of users who have admin or masteradmin role. You cannot access any other part of the site, if you will try to type something into URL then you will get information of revoked Access and **Error 403**, the button for returning back will be shown too. If on other hand you will try to type a site which does not exist, you will get an **Error 404**. You can only Log Out by button on top right corner, which will log you out.

![Logout](https://i.imgur.com/Xk80OFV.png)

#### Password Reset
If you forgot your password, you can click on **forgot yourr password?** from the login screen, you will be prompted to type your email address. After that email will arrive in the same style as confirmation email and link will redirect you to password reset page. 

![Password Reset Page](https://i.imgur.com/wul4KCY.png)

If you fill it up, you will get a message that password was changed and you can log in using a new password. 

### Host
Host is a person, who is hosting games. From the schedule host knows on which game and when he needs to be here. To become a host, you have to be confirmed by one of the admins. If you had been confirmed, you will have to relog to the page to see the changes. As a host you will finally see a menu of items and we will go through all of them.

![Host Menu Items](https://i.imgur.com/t70H12Q.png)

#### Hosting Guide
Hosting Guide is a step by step guide for hosts how to host each game individually, it is a link to google document which on clicking opens in new wwindow. Plan is to move teh guide to be editable on to the page. 

#### Teamkills Script
It is a script, which looks at the Teamkill Value of PUBG games through their API. GLL site does not have the teamkills fixed while scoring through API and this is easy tool to correct the teamkills if there are any. Script will always show the right amount of kills which person should have. To make it work you have to paste the full match ID from PUBG and click on search. 

![TeamKills Script](https://i.imgur.com/jMxJB0j.png)

#### Tournaments - Overview
This is where we start with main functionalities of the site. As the host you want to host specific tournaments, and on this page you have all upcoming/running tournaments and past tournaments. It looks like on the picture and we will go through each point. 

![Tournament Overview](https://i.imgur.com/xQ9ME3s.png)

**Active Tournaments** are all tournaments which did not end up yet. They are default sorted out by their start Date.
**Past Tournament** are all tournament which End time already past the current time. They are sorted by the end time. Tournament which ended up most recently will be on top. 
If you would like to use another ordering, you can order Upcoming or Past tournaments by clicking on the Game/Start Date or End Date. If you click on Game Tournaments will be ordered the same way, bbut bundled by game first. 

![Game ordering](https://i.imgur.com/RoZUw4O.png)

On Default there are only 10 tournaments showed up, to load more, there  is a Load More button on the bottom to load additional 10 more tournaments. 

![Load More Button](https://i.imgur.com/AnNj8DU.png)

Now to specify each of the fields of the tournament
- Available - This is a clickable field, to put up your availability. If you click it in the tournament, you will put availability for teh full tournament with all the rounds inside. 
- Hosting - This field is not clickable and it will show only if you are selected as a host/Teamleader
- Tournament Name - This one is clickable field again and it will redirect you to the tournament itself, which will be spcecified here too. 
- Game - Shows a game in which tournament is held. 
- Start Date - It is a Start Date and time of the tournament. Displayed in your local time.
- End Date - It is a End Date and time of the tournament. Displayed in your local time.

**Search** Field allow you to filter upcoming tournaments. You can either type some string from the tournament or specify the game by typing Game.
If you click anywhere except Tournament Name onto the Tournament row, the tournament will expand to its Rounds as well and you can see slightly more detailed information of Rounds.

![Rounds in OverView](https://i.imgur.com/PbgmdRh.png)

Rounds displaying consists of:
- Available - Again a clickable field, to put up your availability but now only for specified Round
- Hosting - This field is not clickable and it will show only if you are selected as a host/Teamleader for the Round.
- Round Name - Specifying the name of the round.
- Best Of - Shows amount of games which are held within the round, so hosts now how many games they will be hosting.
- Start Date - It is a Start Date and time of the round. Displayed in your local time.
- End Date - It is a End Date and time of the round. Displayed in your local time.

There is one more button **Expand All** . Clicking on the button it will expand all the tournaments to have as well round view. Clickikng again will collapse them instead. 

To select availability you have to click on Hosting fields to choose to your liking what would you like to host. And then you have to confirm the changes. You can then redo the availability as long as you can, if you are already not hosting, then the second field will be marked and you will be unable to change your availability.

![Availability Changes](https://i.imgur.com/jgGxvDc.png)

Last part will show how does it look like, when you are selected for Hosting. You can see that Available field became grey and is not clickable anymore. 

![Selected for Hosting](https://i.imgur.com/fko9dJn.png)

Now we will move if you click on any of the tournaments names. 

#### Tournaments - Specific Tournament 
Being in the tournament, will show more information about the tournament. which was not specified in the Tournaments Overview.

![Tournament](https://i.imgur.com/Waq761H.png)

To specify additional fields.
- ID - ID of the tournament, auto-generated, it is unique
- Series ID - ID of the series tournament is in. This is clickable link which will lead to display full series. Series will be described later.
- Admin Page URL - This is a direct link to tournament page of GLL onto the same tournament. Link is to ease the work and you can just click on it to go straight into the tournament at GLL.
- Region - Specifying in which region the tournament is held in. 

Second part of the tournaments is its Round View.

![Tournament Round View](https://i.imgur.com/goTeVhh.png)

On the top is specified name of the round and its start and end date. Then you can see selected hosts/team leads and icons next to it. On the bottom is displayed best of. 
Icons can be:
- Green - Person did click Ready
- Red - Person did not click Ready
- Orange - Person did click ready, but group did not happen, so host did loose hosting 

You can as well see some numbers next to hosts/teamleads. If the numbers are for hosts, it is the additional or revoked rounds for specific Host, so on Example Picture Leodaddy has +4. Means he did host 2 and as well 4 more so at the end it is 6 rounds. 
Then when it comes to TeamLeads, it is specifying time. So Towby did lead 60 minutes less then he was supposed to. 

Last part what you can do as a host on Tournament Page is clicking Ready, which is next to your name. But Ready button only displays one hour before the tournament and becomes unavailable 30 minutes before. It is a check-in for hosts to see if they are ready within speicifc timeframe before the tournament. 

![Not clickable](https://i.imgur.com/LoY4gm4.png) ![Clickable](https://i.imgur.com/zEB21jD.png) ![Clicked](https://i.imgur.com/tPpk9ed.png)

As you can see on picture, by defualt, the button is grey, but if you are within the needed tiemframe, it will become clickable. One you click it, you cannot unclick it.

#### Series
Series is a database or a list of all series, which are created. Series of the tournaments can be specified, that tournament inside have in common:
- Game
- Partially the name
- Region

![Series Overview](https://i.imgur.com/SGeITAf.png)

As we can see common things which series inherit are displayed in overview. Additionally you can see how many tournaments are already within the series, called as Tournaments count. If you click on any of the series, you will go to specified series itself. 

![Specific Series Overview](https://i.imgur.com/ZsMe63o.png)

On the top of series itself, you can see the series name and then fields:
- Name - Name of the series
- ID - ID of the series
- Game - Game in which series is held
- Region - Region for the series
- Recurrence - can be: 
  - daily - Tournaments are happening several times in the week, the name of the tournaments then is generated as `#WN DDD Series Name` - where WN is Week Number and DDD day of the week in at first three letters
  - weekly - Tournaments happen at most once a week. The name is then generated as follows `#WN Series Name` - where WN is a week number.
 - Start Date - start date and time of the series 
 - End Date - end date and time of the series 
 
You can see here as well **Load Series' Tournaments** button, which will show all the tournaments within the series and clicking on Tournaments we will go to Tournament itself.

![Series Tournaments Overview](https://i.imgur.com/0luFAhO.png)

#### Calendar
Calendar is a week based overview of all the rounds in a compact way, so you have better overview of the tournaments, rounds, hosting. On the top right the week in the year is shown and you can click on it to choose any week to see schedule for the chosen week as shown in the picture and it will display only the chosen week from Monday to Sunday.

![Calendar chooosing week](https://i.imgur.com/9YLS3Ut.png)

You can choose once you select a week which type of tournaments you would like to see. You can choose Specific Games or keep it at All. Overview of the rounds per week is separated first by games and ordered by UTC order start time. To determine in which day the round will display. System is looking into regions and each round is part of the tournament which is in specific region. Each region has its offset value from UTC, which is converted then to Tournament Region Local Start Time. And if this Tournament Region Local Start Time lies in a day, it will show for that day. Can be seen on picture below. 

![Calendar showing matches](https://i.imgur.com/PE4BjyN.png)

As can be seen it is the compact view where first it displays the Tournament name, where clicking would go to tournament page. Under is Round name displayed. And the third row shows your local start time of the tournament and **BO** stands for Best Of to display how many rounds are played. Then it shows Hosts and TeamLeads. 
In front of Hosts you can see Group Number depending on the game, so you know which group you are actually hosting depending on game. As well Round Balance or Time Balance is displayed here and you can see in Example that Leodaddy has +4 more rounds. Each day per game will have as well its own scrollable bar, if there are too many rounds in one day.

![Lost Hosting not Displayed](https://i.imgur.com/76V3oIZ.png)

This view does not display Lost hosting as we can see, where Maya did loose hosting, but in Calendar is not displayed. Calendar only shows people who either did host/lead or are scheduled to host/lead. As the last part to mention in Calendar is whenever you are chosen to host, you will be displayed with yellow person icon and yellow text color, to easier find yourself. 

![User Hosting](https://i.imgur.com/GNmprLU.png)

#### Data
This section is to display total values for Hosting/Leading, additional stats per games and more. First you have to choose in which Month Period you want to look into Data.

![Month Period](https://i.imgur.com/eNvjise.png)

After choosing a month then Data for speciic month are shown. To determine of each round to which month it goes. It takes into consideration Round Tournament Local Start Time in which month it is and put it accordingly for that month. Some tournaments have additional property which regulate if whole tournament is counted by Round Tournament Local Start Time or Every Round belongs to month when tournaments ends.

Data consist of several Parts:
- Overview
  - User - Display Users in alphabetical Order.
  - Games Hosted - Amount of Total Games Hosted per user. Games Hosted are counted as how many rounds did person host. Round balance is considered here and adds to it.
  - Host Value - Based on Games Hosted and amount per game hosted, total value is calculated. More can be seen on other tabs, this is a total amount of all games hosted together.
  - TeamLead Time - Total amount of time per Lead in minutes spent. This is computed based on how much time did Leader have to spend when leading a tournament or tournaments, where if leading several tournaments at the same time are excluded since it is looking into possible collisions of time where Time Balance and Preparation Time for TeamLeaders is considered. Preparation ttime is the value for the round in minutes, which teamleader has to prepare before tournament starts. So first is taken preparation time, then duration of round and the end Time Balance to specify the timeframe. Theen all timeframes are looked at with possible collision and if there is collision, it is not counted towards total time. 
  - TeamLead Value - It is the total amount of expenses per user for Leading based on TeamLead Time. 
  - Total Value - Sum of the Host value and TeamLead value per user. It is translated as total amount of expenses which person will earn or earned. 
  
  ![Data Overview](https://i.imgur.com/veGHCwm.png)

- Games Summary - summary per user per specific game, Overview is sum of all games summaries.
  - User - Display Users in alphabetical Order.
  - Games Hosted - Amount of Total Games Hosted per user per Game.
  - Host Value - Amount of expenses per user based on Games Hosted timed with Game Value.
  - TeamLead Time - Amount of Lead Time per user.
  - TeamLead Value - Amount of expenses per user based on TeamLead Time.
  - Total Value - Sum of the Host value and TeamLead value per user.
  - Game Value - Can be seen on the bottom, is the amount per Game Hosted of the specific Game.
  
  ![Games Summary](https://i.imgur.com/kHMKykC.png)

- Stats - These are total stats per games now than per user specific:
  - Regions - Total stats per Regions
    - Region - Name of the Region.
    - Games Hosted - Amount of games hosted in specific regions from all the games.
    - Total Value - Total amount per Region by games hosted. 

  ![Stats Regions](https://i.imgur.com/gbJFpbh.png)
  
  - Games - Total Stats per Game.
    - Game - Game name.
    - Region | Games Hosted - Particualar Regions and total amount of Games Hosted per Region.
    - Games Hosted - Total Amount of Games Hosted .
    - TeamLead Time - Total Amount of Time per Game.
    - Hosting Value - Total Amount of expenses needed for hosting per game.
    - TeamLead Value - Total Amount of expenses needed for leading per game.
    - Total Value - Counts both Hosting Value and TeamLead Value. So it is total amount of expenses per Game needed.

  ![Stats Games](https://i.imgur.com/459sTwG.png)
  
  - Total - Summing all games together.
    - Games Hosted - All games hosted in the particular month.
    - Hosting - Total amount of costs needed for hosting.
    - Leading - Total amount of costs needed for leading.
    - Total - Summing both hosting and leading.

  ![Stats Total](https://i.imgur.com/IPUkhLW.png)
    
#### Overview 
The last past for the host is the Overview, where user can see, what is he/she going to host or lead. There are some useful links, which are commonly used to have them in one place and not around. 

![Overview](https://i.imgur.com/FGyn3Pa.png)
  
In the **Upcoming tournaments** you can see all the tournaments, which are active and you are either hosting or leading. **Starts** shows for both Rounds and Tournament in which time the tournament or round will start. **Role** can be either host or teamlead. **Ready** is the same as in Tournaments. You can be ready from the overview. Ready will stay grey, until it is one hour before, then it will turn Red and will become clickable, once you click it it will be green. If you miss the 30 mins ready check-in window. It will become grey again and unclickable. 
Default limit of upcoming tournaments is 5 and there is Load More button if you need to see more tournaments. 

On the top there is a scrollable button to Show Past Tournaments. On default it is turned off, but if you turn it on, then you can see simplified version of Past tournaments.   
  
![Past Tournaments](https://i.imgur.com/mB3PfMI.png)

### TeamLead
TeamLeader is a role above Host. TeamLeader takes care of running tournaments smooth, preparing tournaments and taking support. There are not many differences between host and teamleader when it comes to application. Main difference is to be able to schedule people. Only changes between host and teamlead will be shown. 

![Menu Items](https://i.imgur.com/73LvAyD.png)

#### Overview 
Difference here is that Useful Links now contains some more links for Teamleaders. TeamLeaders as well have to check-in before, so even hosts can see that teamleader is ready. 

![Useful Links TL](https://i.imgur.com/LXz3Mgu.png)

#### Tournaments - Specific Tournament 
First changes comes in specific tournaments, where teamleader can now add/remove hosts/leads from the rounds. 

![Tournaments - Hosts/TLs](https://i.imgur.com/LoGUli8.png)

As can be seen, now it looks a little different. Left button with skull next to the host will remove the host from the round. Green button will show you possibility to add a person or lead which selected their availability for the tournament. If there is no one available message No available host will show, if choosing for teamleaders No available teamleaders. You can as well click on any user which is already selected to replace the user with another user from availability list. 

![Tournaments - Hosts/TLs - changes](https://i.imgur.com/MJBiohj.png)

Last thing which is possible here is to click on pencil, here you can change if person did loose hosting or had a difference in rounds so you can add or remove rounds. If it is a teamleader you are adding or removing amount of time.

![Choosing Hosts](https://i.imgur.com/91rC8XI.png) ![Pencil](https://i.imgur.com/5SBwTlE.png) ![Pencil - TLs](https://i.imgur.com/2JqA3Y4.png)

![Round balance](https://i.imgur.com/ZqrRqMZ.png) ![Lost Hosting](https://i.imgur.com/lCmjn3v.png)

If you do any changes you will need to confirm it by prompt notification on bottom right to Save the changes. 

![Confirm changes](https://i.imgur.com/HKzyp4t.png)

When it comes to availability, if host choose that it is available then it will appear only in Hosts, but if teamleader will choose availability, can be chosen both as host or teamlead, but if choosing one of those, then it cannot be chosen for second role. You either host or if you lead, you can host as well, but cannot be counted as extra. Sometimes it can happen, that at the end you needed someone who had not availability choosen, so for past tournaments, you can choose any host/teamleader either for hosting or leading. 

![Choosing in past Tournaments](https://i.imgur.com/z0xsj0e.png)

#### Schedule
This is a new item for teamleaders. The purpose of schedule is to make a compact way of schedulling people around as either hosts or Teamleas. Basic Overview is similar Overviews as Calendar, but now you have possibilities as in Tournaments so you can add/remove, edit Round Balance/Time Balance, and so on. 

![Schedule Overview](https://i.imgur.com/fItOrX7.png)

As can be seen it looks very similar to calendar, but with editing features. You can choose All or any game as you want. Round overview is exactly the same as in Calendar and Editing has all the features as in Tournaments.
Selecting a week now, has only 3 options and those are Current/Previous or Next. It is because when it comes to schedulling those 3 weeks are most important for changes. Previous week is there to check that everything was done properly, but should not have changes to be done. Current week can change based on hosts needed and Next week is there to schedule people for next week.

![Select week](https://i.imgur.com/G3ktFlW.png)

To determine, who is available at which time, you can click on yellow Availability icon on bottom left. which will show all the hosts and leads with their availability. Availability will not show if person is already selected for hosting/leading. From this overview you can easier determine, how you want to put hosts around. 

![Availability Table](https://i.imgur.com/uydjs7F.png)

On the top you can see Tournament Names, and then Rounds. Hosts/Leads are ordered by alphabetical order. **X** stands for available. Tournaments are ordered in the same way, how they are showned on Schedule site page. Availability Table will be displayed based on week selected. 

Last Part in this is another Tab called **Balance** as can be seen on picture below.

![Balance](https://i.imgur.com/NUIOWlM.png)

Balance will show as Availabity table for week selected. It is divided into games, because hosts are being balanced per game individually. Current week value is computed as how many times person in teh current week is selected and timed with Best of per round where person is selected. So if computing Value for Apex is 40 and Round is Best Of 8, then total value is 8*40 = 320. Rounds which are in Tournaments, which have property of Not Counted by Rounds off, are not counted in this balance. Those tournaments are special and are added as extra.

Lost Hosting is a value where person did lost hosting, so he can be compensated. Lost Hosting is from previous week. Because if you loose hosting this week, then you cannot be compensated this week, since schedule is being done for whole next week. Lost hosting happens if person was ready, but unfortunately group he was supposed to host, did not happen. Then teamleader can mark the person who lost hosting by checking lost hosting property and the amount which would be computed goes to next week lost hosting to be compensated.

Difference is computed as `Current week value - Lost Hosting (from previous week)`.

### Admin

### Masteradmin